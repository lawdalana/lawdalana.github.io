---
title : [Digest] Can we Retrieve Everything All at Once
notetype : feed
date : 07-02-2025
---

## Source: [Can we Retrieve Everything All at Once? ARM: An Alignment-Oriented LLM-based Retrieval Method](https://arxiv.org/abs/2501.18539)


### Intro
#### Problem
- ในโลกความเป็นจริงการจะตอบคำถามที่เป็น Open-domain จะต้องใช้ข้อมูลจากหลายๆส่วนรวมเข้าด้วยกัน + ขั้นตอนที่ยุ่งยากเพื่อเอาคำตอบออกมา

#### Solution V1
- แต่ LLM ก็ทำให้ขั้นตอนในการตอบคำถามนั้นง่ายขึ้น ซึ่งงานส่วนใหญ่จะเป็นการพัฒนา model retrieval ให้เหมาะกับคำถามยากๆเท่านั้น

#### Solution V2
- ต่อมามีการพัฒนา LLM ให้ตอบคำถามยากๆ โดยการแตกคำถามที่ซับซ้อนออกเป็น คำถามง่ายๆ หลายคำถาม และนำแต่ละคำถามไปค้นหาข้อมูลที่เกี่ยวข้อง แล้วจึงสรุปออกมา 
- แต่ LLM ก็ยังไม่สามารถรู้ได้ว่ามีข้อมูลที่ใช้ได้อื่นๆอีกไหม

#### Solution V3
- การพัฒนาในขั้นต่อมาก็คือการให้ LLM สามารถ interact กับ data collection ได้ตรงๆ ซึ่งจะทำให้ LLM สามารถ explore ได้เองว่ามีข้อมูลอะไรอยู่บ้าง แล้วดึงมาเช็คเอง

#### Solution V3.1
- ซึ่งตัวที่สามารถทำได้ดีคือ LLM ตัวที่เป็น reasoning and acting หรือก็คือ LLM จะดึงข้อมูลไปเรื่อยๆ และคอยเช็คว่าข้อมูลที่ได้มาเพียงพอที่จะต้อบคำถามที่ซับซ้อนหรือยัง ถ้ายัง ก็จะไปตัดสินใจว่าจะดึงข้อมูลตรงส่วนมาเพิ่ม
- วิธีนี้เป็นวิธีที่ดี แต่ตัว LLM ก็ต้องคอยไปดึงอยู่เรื่อยๆ เพราะต้อง explore ซึ่งจะเปลือง time and cost
- LLM เมื่อมีการวนหลายๆรอบ จะเกิดปัญหา [reasoning derailment] ส่งผลให้ตอบผิด

#### Solution V4 (ARM: An Alignment-Oriented LLM-based Retrieval Method)
- ARM เป็นวิธีการเรียกค้นข้อมูลที่ เน้นการจัดแนวข้อมูลให้เหมาะสมกับโครงสร้างของชุดข้อมูล ทำให้สามารถดึงข้อมูลทั้งหมดที่จำเป็นได้ในครั้งเดียว
- ARM ผสานการใช้เหตุผลเกี่ยวกับความสัมพันธ์ของข้อมูล ช่วยให้สามารถดึงข้อมูลที่เกี่ยวข้องโดยเชื่อมโยงข้อมูลที่อาจไม่ได้ถูกกล่าวถึงโดยตรงในคำถาม

![Summary approach ARM](/assets/img/Other/Knowledge/ARM_RAG.avif) 
---

### Overview

- ARM ซึ่งเป็นแนวทางการเรียกค้นข้อมูลที่สอดคล้องกับโครงสร้างของชุดข้อมูล โดยใช้แนวคิด retrieving while generating เพื่อให้ LLM สามารถใช้ความสามารถในการให้เหตุผลร่วมกับการเรียกค้นข้อมูล (รวมกระบวนการเรียกค้นและการใช้เหตุผลเข้าด้วยกันเป็นกระบวนการเดียว โดยอาศัยข้อมูลจากโครงสร้างของข้อมูลที่มีอยู่)
- ปัญหาหลักของการเรียกค้นแบบเดิมคือ LLM อาจสามารถระบุข้อมูลที่จำเป็นได้ แต่ไม่สามารถเชื่อมโยงข้อมูลเข้ากับแหล่งข้อมูลที่มีอยู่จริง
- ARM เป็นกระบวนที่มีหลายขั้นตอน โดยแต่ละขั้นตอนมุ่งเน้นไปที่การจัดแนวข้อมูล (alignment) กับชุดข้อมูลที่มีอยู่
- ในขั้นตอนแรก information alignment เพื่อกำหนดข้อมูลหลักที่จำเป็นต่อคำถาม โดยอาศัยการแมปคีย์เวิร์ดกับ N-grams จากชุดข้อมูล
- ขั้นตอนต่อมาเป็น structure alignment ซึ่งช่วยระบุความเชื่อมโยงระหว่างข้อมูลต่างๆ ที่ถูกเรียกค้น พร้อมทั้งเติมเต็มข้อมูลที่อาจขาดหายไป
- สุดท้ายใช้ self-verification เพื่อให้ LLM ตรวจสอบและคัดกรองข้อมูลที่เกี่ยวข้องมากที่สุด และรวมผลลัพธ์จากหลายแนวทางผ่านกระบวนการ beam search เพื่อให้ได้ชุดข้อมูลที่เหมาะสมที่สุดสำหรับการตอบคำถาม
---

### Methodology
#### Indexing
- เรารวมแหล่งข้อมูลทุกประเภท (เช่น ตารางและข้อความ) ให้อยู่ในรูปแบบของ textual data objects และทำการแบ่งข้อมูลเป็นชิ้นเล็กๆ (chunking)
- ข้อมูลแต่ละส่วนจะมีหัวข้อ concatenation ติดไปด้วย ถ้าเป็นตาราง ก็จะมีคำอธิบายเพิ่มเข้าไปอีก
- แต่ละ chunk จะถูกแปลงเป็น embedding และ สร้าง Index ด้วย N-grams (1-3 Grams) เพื่อใช้ในการค้นหาข้อมูลที่เกี่ยวข้องได้รวดเร็วขึ้น
- ทั้ง embedding และ N-Grams จะช่วยให้ guide LLM ให้ค้นข้มูลว่าตรงไหนใช้ตอบคำถามได้

#### Alignment
##### Information Alignment
- เราใช้ LLM ในการแยกคีย์เวิร์ดจากคำถาม และจับคู่กับ N-grams ที่มีอยู่ในฐานข้อมูล เพื่อให้การเรียกค้นข้อมูลมีความแม่นยำมากขึ้น
- ใช้ Constrained Beam Decoding เพื่อจำกัดการถอดรหัสของ LLM ให้ตรงกับข้อมูลที่อยู่ในฐานข้อมูลแทนการสร้างข้อความใหม่ที่อาจไม่มีอยู่จริง
- ข้อมูลที่เรียกค้นได้จะถูกจัดอันดับโดยใช้ BM25 และ embedding similarity เพื่อให้แน่ใจว่าข้อมูลที่ได้มีความสัมพันธ์กับคำถามมากที่สุด

##### Structure Alignment
- หลังจากระบุข้อมูลที่เกี่ยวข้องแล้ว เรายังต้องจัดโครงสร้างข้อมูลให้ถูกต้อง โดยหาความสัมพันธ์ระหว่างข้อมูล เช่น ตารางที่เชื่อมต่อกัน หรือหน่วยข้อมูลที่เป็นสะพานเชื่อม (bridging entities)
- LLM อาจไม่สามารถเข้าใจโครงสร้างของข้อมูลทั้งหมดได้ ดังนั้น เราใช้ external solver เพื่อช่วยวิเคราะห์โครงสร้างของข้อมูลและเลือกข้อมูลที่มีความเกี่ยวข้องสูงสุด
- เราใช้ Mixed-Integer Programming (MIP) เพื่อหากลุ่มข้อมูลที่เหมาะสมที่สุดสำหรับการตอบคำถาม โดยคำนึงถึง relevance (ความสัมพันธ์กับคำถาม) และ compatibility (การเชื่อมโยงระหว่างข้อมูล)

##### Self-Verification and Aggregation
- ARM ให้ LLM ทำหน้าที่เป็น self-verifier โดยตรวจสอบว่าข้อมูลที่เรียกค้นมาเพียงพอและเชื่อมโยงกันหรือไม่
- เราใช้ constraint decoding เพื่อบังคับให้ LLM เลือกเฉพาะข้อมูลที่มาจากฐานข้อมูลจริงเท่านั้น เพื่อป้องกันข้อผิดพลาด
- เราใช้ beam search aggregation เพื่อนำผลลัพธ์จากหลายแนวทางมาประมวลผลรวมกัน โดยให้คะแนนความมั่นใจของแต่ละข้อมูล (confidence score) ก่อนตัดสินใจเลือกชุดข้อมูลสุดท้ายสำหรับการตอบคำถาม
---
...